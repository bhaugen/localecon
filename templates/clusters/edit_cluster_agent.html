{% extends "base.html" %}

{% load humanize %}

{% block title %}
     Edit Agent {{ agent }}
{% endblock %}

{% block extra_head %}

<style>

body {font-size:90%}
h1 {font-size:2.25em}
h2 {font-size:1.6875em}
p {font-size:0.7875em}
	
</style>

{% endblock %}

{% block content %}

{% include "clusters/_cluster_nav.html" %}

<h3>Edit Agent {{ agent }} in Cluster {{ cluster }}</h3>

<br />
<table>
	<tr>
		<th style="text-align: left; font-size: 110%; padding-top: 1em; " colspan="3" ><b>Agent:</b> {{ agent.name }}</th>
	</tr>
	<form action="{% url inline_new_agent_function cluster_id=cluster.id agent_id=agent.id %}" method="POST">{% csrf_token %}
	<tr>
		<th style="text-align: right;" >New Function:</th>
		<td>{{ new_function_form.function }}</td>
		<td><input type="submit" name="submit" value="Add" /></td>
		<td>&nbsp;</td>
	</tr>
	{% if agent.cluster_functions %}	
		{% for fun in agent.cluster_functions %}
			<tr>
				<td style="padding-top: .5em; text-align: left;" colspan="3" > <b>Function:</b> {{ fun.function.name }}</td>

			</tr>

		</form>
			<tr>
				<th>Function Resources:</th>
				<th>Resource</th>
				<th>Amount</th>
			</tr>
			{% for res in fun.resources %}
				<tr>
					<td style="text-align: right;" >{{ fun.function.name }}</td>
					<td> {{ res.role }} {{ res.resource_type }}</td>
					<td style="text-align: right;" >{{ res.amount|intcomma }}</td>
				</tr>
				{% for agent_res in res.agent_resource_list %}
					<tr>
						<td>&nbsp;</td>
						<td><b>{{ agent.name }}</b>  {{ agent_res.role }} {{ agent_res.resource_type }} </td>
						<td style="text-align: right;" >
							{{ agent_res.amount|intcomma }}
						</td>
					</tr>
				{% endfor %}
				<tr>
					<th style="text-align: right;" >{{ agent.name }}</th>
					<form action="{% url inline_agent_resource cluster_id=cluster.id agent_id=agent.id parent_id=res.resource_type.id %}" method="POST">
						{% csrf_token %}
						<td>
							{{ res.agent_resource_form.role }}&nbsp;
							{{ res.agent_resource_form.name }}
						</td>					
						<td>{{ res.agent_resource_form.amount }}</td>
						<td><input type="submit" name="submit" value="Add" /></td>
					</form>
				</tr>
			{% endfor %}
		{% endfor %}
	{% else %}
		<tr>
			<td>
				To participate in a Cluster, an Agent must perform at least one Cluster Function.
			</td>
		</tr>
	{% endif %}

</table>
{% comment %}
<script src="http://www.google.com/jsapi"></script>
<script>
	
	google.load("jquery", "1.3.2");
</script>
{% endcomment %}
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>

  <link rel="stylesheet" href="/site_media/css/jquery.autocomplete.css" type="text/css" />
  <script type="text/javascript" src="/site_media/scripts/jquery.bgiframe.min.js"></script>

  <script type="text/javascript" src="/site_media/scripts/jquery.autocomplete.js"></script>


<script>
	
function html_unescape(text) {
    // Unescape a string that was escaped using django.utils.html.escape.
    text = text.replace(/&lt;/g, '<');
    text = text.replace(/&gt;/g, '>');
    text = text.replace(/&quot;/g, '"');
    text = text.replace(/&#39;/g, "'");
    text = text.replace(/&amp;/g, '&');
    return text;
}
	
var resourceNames = html_unescape("{{ resource_names }}").split("~");

$(document).ready(function(){
	$(".resource-name").autocomplete(resourceNames, {matchContains: true});
});

 </script>
{% endblock %}
