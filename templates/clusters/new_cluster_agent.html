{% extends "base.html" %}

{% block title %}
     New Agent for Cluster {{ cluster }}
{% endblock %}

{% block extra_head %}

<style>

body {font-size:90%}
h1 {font-size:2.25em}
h2 {font-size:1.6875em}
p {font-size:0.7875em}
	
</style>

{% endblock %}

{% block content %}



<h3>New Agent for Cluster {{ cluster }}</h3>

{% include "clusters/_cluster_nav.html" %}
<br />
	<form action="." method="POST" >
		<table>
			{{ form }}
		</table>
		<input type="submit" value="Submit" />
	</form>

<script src="http://www.google.com/jsapi"></script>
<script>
	
	google.load("jquery", "1.3.2");
</script>
  <link rel="stylesheet" href="/site_media/css/jquery.autocomplete.css" type="text/css" />
  <script type="text/javascript" src="/site_media/scripts/jquery.bgiframe.min.js"></script>

  <script type="text/javascript" src="/site_media/scripts/jquery.autocomplete.js"></script>


<script>
	
//var names = "{{ agent_names }}";
//var cleanAgentNames = decodeURI(names);
var agentNames = "{{ agent_names }}".split("~");
for(i=0;i<agentNames.length;i++)
{
	var index = i;
	var thisName = agentNames[index];
	var thisName = decodeURI(thisName);
	agentNames[i] = decodeURI(agentNames[i]);
}
	
$(document).ready(function(){
	$("#id_name").blur(getAddress);
	$("#id_name").autocomplete(agentNames, {matchContains: true});
});
	

function getAddress(event)
{
	var name = event.target.value;
	//var cleanNames = cleanAgentNames;
	var theNames = agentNames;
	for(i=0;i<agentNames.length;i++)
	{
		var thisName = agentNames[i];
		if(agentNames[i]==name)
		{
			var jsonUrl = encodeURI("/clusters/jsonagentaddress/" + name + "/");
			$.get(jsonUrl,
				function(data){
					var evalData = eval(data);
					var address = evalData[0].fields.address;
					//alert("Data Loaded: " + evalData + ", address:" + address);
					$("#id_address").attr("value", address);
				});
			break;
		}

	}
}
	
 </script>


{% endblock %}
